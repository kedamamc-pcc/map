{"version":3,"file":"script.js","sources":["../src/script/icons.js","../src/script/map.js","../src/script/maptypes.js","../src/script/index.js"],"sourcesContent":["export default {};\r\n","import Icons from './icons.js';\r\n\r\nconst Z1 = 4;\r\nconst SCALE = 100;\r\nconst FACTOR = 1 << Z1;\r\n\r\nconst projection = {\r\n  fromLatLngToPoint(latLng) {\r\n    return new google.maps.Point(latLng.lng() * SCALE, latLng.lat() * SCALE);\r\n  },\r\n  fromPointToLatLng(point) {\r\n    let [x, z] = point instanceof Array ? point : [point.x, point.y];\r\n    return new google.maps.LatLng(z / SCALE, x / SCALE, true);\r\n  },\r\n\r\n};\r\nconst conversion = {\r\n  fromLatLngToBlock(latLng) {\r\n    let point = projection.fromLatLngToPoint(latLng);\r\n    return [point.x, point.y].map(n => Math.floor(n * FACTOR));\r\n  },\r\n  fromBlockToLatLng(coord) {\r\n    return projection.fromPointToLatLng(coord.map(c => (c + .5) / FACTOR));\r\n  },\r\n};\r\n\r\nclass Map extends google.maps.Map {\r\n  constructor(el, opts) {\r\n    let _opts = Object.assign({\r\n      streetViewControl: false,\r\n      mapTypeControl: false,\r\n      panControl: false,\r\n      scaleControl: false,\r\n      zoomControl: true,\r\n    }, opts);\r\n    _opts.center = conversion.fromBlockToLatLng(_opts.center || [0, 0]);\r\n\r\n    super(el, _opts);\r\n  }\r\n\r\n  setOptions(opts) {\r\n    if (opts.center) {\r\n      opts.center = conversion.fromBlockToLatLng(opts.center);\r\n    }\r\n    super.setOptions(opts);\r\n  }\r\n\r\n  addMapType(opts) {\r\n    opts.tileSize = new google.maps.Size(...opts.tileSize);\r\n    let mapType = new google.maps.ImageMapType(opts);\r\n    mapType.projection = projection;\r\n    this.mapTypes.set(opts.id, mapType);\r\n  }\r\n\r\n  getCenterCoord() {\r\n    return conversion.fromLatLngToBlock(super.getCenter());\r\n  }\r\n\r\n  mark(coord, opts = {}, override = opts) {\r\n    let marker = new google.maps.Marker({\r\n      map: this,\r\n      position: conversion.fromBlockToLatLng(coord),\r\n      icon: Icons[opts.icon || 'default'],\r\n    });\r\n  }\r\n}\r\n\r\nexport default Map;\r\n","const Z1 = 4;\r\nconst SCALE = 100;\r\nconst FACTOR = (1 << Z1) * SCALE;\r\nconst journeyMapZooms = ['0.0625', '0.125', '0.25', '0.5', '1', '2', '4'];\r\n\r\nexport default [\r\n  {\r\n    id: 'v2-day',\r\n    name: '[v2] 日间',\r\n    getTileUrl({x, y}, zoom) {\r\n      return `tiles/journeymap/images/z${Math.pow(2, zoom - Z1)}/${x},${y}.png`;\r\n    },\r\n    tileSize: [512, 512],\r\n    minZoom: 0,\r\n    maxZoom: journeyMapZooms.length - 1,\r\n  },\r\n  {\r\n    id: 'v2-night',\r\n    name: '[v2] 夜间',\r\n    getTileUrl({x, y}, zoom) {\r\n      return `tiles/journeymap_night/images/z${journeyMapZooms[zoom - 1]}/${x},${y}.png`;\r\n    },\r\n    tileSize: [512, 512],\r\n    minZoom: 1,\r\n    maxZoom: journeyMapZooms.length,\r\n  },\r\n  {\r\n    id: 'v2-topo',\r\n    name: '[v2] 等高线',\r\n    getTileUrl({x, y}, zoom) {\r\n      return `tiles/journeymap_topo/images/z${journeyMapZooms[zoom - 1]}/${x},${y}.png`;\r\n    },\r\n    tileSize: [512, 512],\r\n    minZoom: 1,\r\n    maxZoom: journeyMapZooms.length,\r\n  },\r\n];\r\n","import Map from './map';\r\nimport mapTypeOpts from './maptypes';\r\n\r\nconst RE_HASH = /^#\\/(\\d+)\\/(\\d+)\\/(-?\\d+,-?\\d+)/;\r\nconst defHashTokens = RE_HASH.exec(RE_HASH.test(location.hash) ? location.hash : '#/0/4/0,0');\r\n\r\nnew Vue({\r\n  el: '#page',\r\n  data: {\r\n    _map: null,\r\n    _mapTypes: mapTypeOpts,\r\n\r\n    isDrawerOpened: false,\r\n    isDragging: false,\r\n\r\n    mapTypeNum: +defHashTokens[1],\r\n    zoom: +defHashTokens[2],\r\n    center: defHashTokens[3].split(',').map(n => +n),\r\n  },\r\n  computed: {\r\n    hash() {\r\n      return `#/${this.mapTypeNum}/${this.zoom}/${this.center.join(',')}`;\r\n    },\r\n  },\r\n  watch: {\r\n    hash: {\r\n      handler: function (val) {\r\n        location.hash = val;\r\n      },\r\n      immediate: true,\r\n    },\r\n  },\r\n  methods: {\r\n    changeMapType(id) {\r\n      this.$data._map.setMapTypeId(id);\r\n    },\r\n    onhashchange({newURL}) {\r\n      let newHash = newURL.slice(newURL.indexOf('#'));\r\n      if (RE_HASH.test(newHash)) {\r\n        let tokens = RE_HASH.exec(newHash);\r\n        this.mapTypeNum = +tokens[1];\r\n        this.zoom = +tokens[2];\r\n        this.center = tokens[3].split(',').map(n => +n);\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    // 监听 Hash 外部变化\r\n    window.onhashchange = this.onhashchange;\r\n  },\r\n  mounted() {\r\n    // 实例化地图对象\r\n    const map = this.$data._map = new Map(document.getElementById('map'), {\r\n      mapTypeId: mapTypeOpts[this.mapTypeNum].id,\r\n      zoom: this.zoom,\r\n      center: this.center,\r\n      backgroundColor: '#000',\r\n    });\r\n    // 添加视图类型\r\n    mapTypeOpts.forEach(opts => {\r\n      map.addMapType(opts)\r\n    });\r\n    // 添加事件\r\n    map.addListener('center_changed', _=> {\r\n      this.center = map.getCenterCoord();\r\n    });\r\n  },\r\n});\r\n"],"names":["const","let","super","Z1","this"],"mappings":"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"}