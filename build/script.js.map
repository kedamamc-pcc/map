{"version":3,"file":"script.js","sources":["../src/script/icons.js","../src/script/map.js","../src/script/maptypes.js","../src/script/index.js"],"sourcesContent":["export default {};\r\n","import Icons from './icons.js';\r\n\r\nconst Z1 = 4;\r\nconst SCALE = 100;\r\nconst FACTOR = 1 << Z1;\r\n\r\nconst projection = {\r\n  fromLatLngToPoint(latLng) {\r\n    return new google.maps.Point(latLng.lng() * SCALE, latLng.lat() * SCALE);\r\n  },\r\n\r\n  fromPointToLatLng(point) {\r\n    let [x, z] = point instanceof Array ? point : [point.x, point.y];\r\n    return new google.maps.LatLng(z / SCALE, x / SCALE, true);\r\n  },\r\n\r\n  fromBlockToLatLng(coord) {\r\n    return this.fromPointToLatLng(coord.map(c => (c + .5) / FACTOR));\r\n  }\r\n};\r\n\r\nclass Map extends google.maps.Map {\r\n  constructor(el, opts) {\r\n    let _opts = Object.assign({\r\n      streetViewControl: false,\r\n      mapTypeControl: false,\r\n      panControl: false,\r\n      scaleControl: false,\r\n      zoomControl: true,\r\n    }, opts);\r\n    _opts.center = projection.fromBlockToLatLng(_opts.center || [0, 0]);\r\n    super(el, _opts);\r\n  }\r\n\r\n  addMapType(opts) {\r\n    opts.tileSize = new google.maps.Size(...opts.tileSize);\r\n    let mapType = new google.maps.ImageMapType(opts);\r\n    mapType.projection = projection;\r\n    this.mapTypes.set(opts.id, mapType);\r\n  }\r\n\r\n  mark(coord, opts = {}, override = opts) {\r\n    let marker = new google.maps.Marker({\r\n      map: this,\r\n      position: projection.fromBlockToLatLng(coord),\r\n      icon: Icons[opts.icon || 'default'],\r\n    });\r\n  }\r\n}\r\n\r\nexport default Map;\r\n","const Z1 = 4;\r\nconst SCALE = 100;\r\nconst FACTOR = (1 << Z1) * SCALE;\r\nconst journeyMapZooms = ['0.0625', '0.125', '0.25', '0.5', '1', '2', '4'];\r\n\r\nexport default [\r\n  {\r\n    id: 'v2-day',\r\n    name: '[v2] 日间',\r\n    getTileUrl({x, y}, zoom) {\r\n      return `tiles/journeymap/images/z${Math.pow(2, zoom - Z1)}/${x},${y}.png`;\r\n    },\r\n    tileSize: [512, 512],\r\n    minZoom: 0,\r\n    maxZoom: journeyMapZooms.length - 1,\r\n  },\r\n  {\r\n    id: 'v2-night',\r\n    name: '[v2] 夜间',\r\n    getTileUrl({x, y}, zoom) {\r\n      return `tiles/journeymap_night/images/z${journeyMapZooms[zoom - 1]}/${x},${y}.png`;\r\n    },\r\n    tileSize: [512, 512],\r\n    minZoom: 1,\r\n    maxZoom: journeyMapZooms.length,\r\n  },\r\n  {\r\n    id: 'v2-topo',\r\n    name: '[v2] 等高线',\r\n    getTileUrl({x, y}, zoom) {\r\n      return `tiles/journeymap_topo/images/z${journeyMapZooms[zoom - 1]}/${x},${y}.png`;\r\n    },\r\n    tileSize: [512, 512],\r\n    minZoom: 1,\r\n    maxZoom: journeyMapZooms.length,\r\n  },\r\n];\r\n","import Map from './map';\r\nimport mapTypeOpts from './maptypes';\r\n\r\nnew Vue({\r\n  el: '#page',\r\n  data: {\r\n    _map: null,\r\n    _mapTypes: mapTypeOpts,\r\n\r\n    isDrawerOpened: false,\r\n\r\n    mapTypeNum: 0,\r\n    zoom: 4,\r\n    center: [0, 0],\r\n  },\r\n  computed: {\r\n    hash: {\r\n      get() {\r\n        console.log('reading hash');\r\n        let tokens = location.hash.slice(1).split('/');\r\n        if (tokens.length === 3) {\r\n          this.mapTypeNum = Number(tokens[0]);\r\n          this.zoom = Number(tokens[1]);\r\n          this.center = tokens[2].split(',').map(n => Number(n));\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      },\r\n      set(upd) {\r\n        let obj = Object.assign({}, this.hash, upd);\r\n        location.hash = `#${obj.mapTypeNum}/${obj.zoom}/${obj.center.join(',')}`;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    changeMapType(id) {\r\n      this.$data._map.setMapTypeId(id);\r\n    },\r\n  },\r\n  beforeMount() {\r\n    if (!this.hash) {\r\n      this.hash = {\r\n        mapTypeNum: this.mapTypeNum,\r\n        zoom: this.zoom,\r\n        center: this.center,\r\n      };\r\n    }\r\n  },\r\n  mounted() {\r\n    const map = this.$data._map = new Map(document.getElementById('map'), {\r\n      mapTypeId: mapTypeOpts[this.mapTypeNum].id,\r\n      zoom: this.zoom,\r\n      center: this.center,\r\n      backgroundColor: '#000',\r\n    });\r\n    mapTypeOpts.forEach(opts => {\r\n      map.addMapType(opts)\r\n    });\r\n  },\r\n});\r\n"],"names":["const","let","super","Z1"],"mappings":"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"}